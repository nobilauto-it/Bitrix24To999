================================================================================
CHANGELOG ‚Äî 2026-01-31
================================================================================
–§–∞–π–ª –¥–ª—è —É—á—ë—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ‚Äî –¥–æ–ø–æ–ª–Ω—è—Ç—å
—ç—Ç–æ—Ç —Ñ–∞–π–ª –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å—å—é —Å –¥–∞—Ç–æ–π/–≤—Ä–µ–º–µ–Ω–µ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º.
================================================================================

--- 2026-01-31 (—Å–µ—Å—Å–∏—è 1) ---

1. TELEGRAM: –ö–õ–ò–ö–ê–ë–ï–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê –í –£–í–ï–î–û–ú–õ–ï–ù–ò–ò
   –ü—Ä–æ–±–ª–µ–º–∞: –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ¬ª –Ω–µ –±—ã–ª–æ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏.
   –†–µ—à–µ–Ω–∏–µ:
   - –í send_telegram_notification_999() –¥–æ–±–∞–≤–ª–µ–Ω parse_mode="HTML".
   - –°—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ HTML: <a href="https://999.md/ru/{advert_id}">–û—Ç–∫—Ä—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>.
   - –í Telegram –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–∏–Ω—è—è –ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç–∞—è —Å—Å—ã–ª–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ¬ª.
   –§–∞–π–ª: publish_999md.py, —Ñ—É–Ω–∫—Ü–∏—è send_telegram_notification_999 (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫ 1453‚Äì1482).

2. –ù–ê–ó–í–ê–ù–ò–ï –û–ë–™–Ø–í–õ–ï–ù–ò–Ø: –û–î–ò–ù –ò–°–¢–û–ß–ù–ò–ö (–ù–ï –°–ú–ï–®–ò–í–ê–¢–¨ TITLE –ò –ú–ê–†–ö–£)
   –ü—Ä–æ–±–ª–µ–º–∞: –Ω–∞–∑–≤–∞–Ω–∏–µ –±—Ä–∞–ª–æ—Å—å –∏ –∏–∑ title, –∏ –∏–∑ –º–∞—Ä–∫–∏ ‚Äî –Ω—É–∂–Ω–∞ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å.
   –†–µ—à–µ–Ω–∏–µ: –æ–¥–Ω–æ –ø–æ–ª–µ ¬´–Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è¬ª ‚Äî –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫:
   - –ï—Å–ª–∏ –≤ Bitrix –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ title ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–Ω–æ (–ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Ç –Ω–æ–º–µ—Ä–∞ –∏ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤).
   - –ï—Å–ª–∏ title –ø—É—Å—Ç–æ–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ ¬´–º–∞—Ä–∫–∞ + –º–æ–¥–µ–ª—å¬ª.
   –ò–∑–º–µ–Ω–µ–Ω–∏—è:
   a) car_data_from_raw() (publish_999md.py):
      - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è listing_title: raw.get("title") (–æ—á–∏—â–µ–Ω–Ω—ã–π) –∏–ª–∏ f"{marca} {model}".
      - –í –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ "listing_title".
   b) build_advert_payload():
      - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä listing_title: Optional[str] = None.
      - –î–ª—è —Ñ–∏—á–∏ 12 (–Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ 999): –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω listing_title ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω; –∏–Ω–∞—á–µ –º–∞—Ä–∫–∞+–º–æ–¥–µ–ª—å.
   c) publish_car_manual():
      - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä listing_title: Optional[str] = None, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ build_advert_payload.
   d) –í—Å–µ –≤—ã–∑–æ–≤—ã publish_car_manual –∏–∑ car_data_from_raw –ø–µ—Ä–µ–¥–∞—é—Ç listing_title=car.get("listing_title"):
      - POST /publish —Å item_id (api_publish_car_manual);
      - publish_random_car_to_999();
      - _auto_publish_loop() (–∞–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞).
   –§–∞–π–ª: publish_999md.py (car_data_from_raw, build_advert_payload, publish_car_manual, –≤—Å–µ –≤—ã–∑–æ–≤—ã publish_car_manual).

3. –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï: –ê–í–¢–û–ú–ê–¢–ò–ö–ê –ò–°–ü–û–õ–¨–ó–£–ï–¢ –¢–û –ñ–ï –ü–†–ê–í–ò–õ–û
   –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ 999 (—Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –∏–∑ start_auto_publish_999_thread) —É–∂–µ –ø–µ—Ä–µ–¥–∞—ë—Ç listing_title –≤ publish_car_manual ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫ –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.

--- 2026-01-31 (—Å–µ—Å—Å–∏—è 2) ---

4. TELEGRAM: –®–ê–ë–õ–û–ù –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ü–û –ü–†–û–°–¨–ë–ï
   –ó–∞–¥–∞—á–∞: —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –ø–æ —à–∞–±–ª–æ–Ω—É ‚Äî –≤–æ—Ä–æ–Ω–∫–∞, –º–∞—Ä–∫–∞/–º–æ–¥–µ–ª—å/–Ω–æ–º–µ—Ä, —Å—Å—ã–ª–∫–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å¬ª –∏ ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª, —Ç–µ–∫—Å—Ç ¬´–ó–∞–π–¥–∏, –ø—Ä–æ–≤–µ—Ä—å –∏ –æ–ø—É–ª–ª–∏–∫—É–π –æ–±—ä—è–≤–ª–µ–Ω–∏–µ¬ª, ¬´–∏ —Ñ–æ—Ç–∫–∞ –∞–≤—Ç–æ=)¬ª.
   –†–µ—à–µ–Ω–∏–µ:
   - –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –≤–æ—Ä–æ–Ω–æ–∫ FUNNEL_NAMES: category_id "111" -> "Vinzari realizari" (–ø–æ–∫–∞ –æ–¥–Ω–∞ –≤–æ—Ä–æ–Ω–∫–∞).
   - send_telegram_notification_999() –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç advert_id, marca, model, numar_auto, category_id.
   - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:
     ‚Ä¢ ¬´–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ê–≤—Ç–æ {–ò–º—è –≤–æ—Ä–æ–Ω–∫–∏}¬ª
     ‚Ä¢ ¬´{–ú–∞—Ä–∫–∞} {–ú–æ–¥–µ–ª—å} {–ù–æ–º–µ—Ä –∞–≤—Ç–æ}¬ª
     ‚Ä¢ ¬´üîó –û—Ç–∫—Ä—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ¬ª (—Å—Å—ã–ª–∫–∞ https://999.md/ru/{id})
     ‚Ä¢ ¬´–ó–∞–π–¥–∏, –ø—Ä–æ–≤–µ—Ä—å –∏ –æ–ø—É–ª–ª–∏–∫—É–π –æ–±—ä—è–≤–ª–µ–Ω–∏–µ ‚Äî¬ª
     ‚Ä¢ ¬´ü§≥ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ¬ª (—Å—Å—ã–ª–∫–∞ https://999.md/ro/{id}/edit?offer_type=776 –∏ –¥—É–±–ª—å ru)
     ‚Ä¢ ¬´–∏ —Ñ–æ—Ç–∫–∞ –∞–≤—Ç–æ=)¬ª
   - –í –≤—ã–∑–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ publish_car_manual –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è marca, model, numar_auto, category_id (–∏–∑ kwargs).
   - –í–æ –≤—Å–µ –≤—ã–∑–æ–≤—ã publish_car_manual –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ category_id=raw.get("categoryId") (API –ø–æ item_id, publish_random_car_to_999, _auto_publish_loop).
   –§–∞–π–ª: publish_999md.py (FUNNEL_NAMES, send_telegram_notification_999, –≤—ã–∑–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –≤—ã–∑–æ–≤—ã publish_car_manual —Å category_id).

5. –ê–í–¢–û-–û–¢–ü–†–ê–í–ö–ê –ù–ê 999: –õ–û–ì–ò–ö–ê –¢–û–ß–ù–û –ö–ê–ö –í auto_send_tg
   –ü—Ä–æ–±–ª–µ–º–∞: –Ω–∞ 999 —É—Ö–æ–¥–∏–ª–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–∞—à–∏–Ω, –≤ Telegram –ø–æ –ø—Ä–∏–º–µ—Ä—É ‚Äî –ø–æ—á—Ç–∏ –Ω–∏—á–µ–≥–æ; —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏, —Ä–∏—Å–∫ –ª–∏—à–Ω–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.
   –†–µ—à–µ–Ω–∏–µ: –ø—Ä–∏–≤–µ—Å—Ç–∏ fetch_next_raw_for_999 –∫ –ª–æ–≥–∏–∫–µ fetch_next_raw_with_photos (auto_send_tg) –æ–¥–∏–Ω –≤ –æ–¥–∏–Ω:
   - JOIN –ø–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º: s.item_id = NULLIF(t.raw->>'id','')::bigint (–∫–∞–∫ –≤ TG; —Ä–∞–Ω—å—à–µ –±—ã–ª–æ (t.raw->>'id')::bigint).
   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: COALESCE(t.categoryid::text, t.raw->>'categoryId') = %s (–∫–∞–∫ –≤ TG; —Ä–∞–Ω—å—à–µ —Ç–æ–ª—å–∫–æ raw->>'categoryId'). –ù—É–∂–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ categoryid –≤ b24_sp_f_1114.
   - –í–æ–∑—Ä–∞—Å—Ç: —Ç–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ —Å—Ç–∞—Ä—à–µ 14 –¥–Ω–µ–π ‚Äî —É–±—Ä–∞–Ω–æ ¬´OR created_expr IS NULL¬ª (—Ä–∞–Ω—å—à–µ —Å NULL –¥–∞—Ç–æ–π —Ç–æ–∂–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –≤—ã–±–æ—Ä–∫—É, –ø–æ—ç—Ç–æ–º—É –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ).
   - –£—Å–ª–æ–≤–∏—è –ø–æ —Ñ–æ—Ç–æ –∏ —Å–∫–∞–ª—è—Ä–Ω—ã–º –ø–æ–ª—è–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π; created_expr —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º t. –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏.
   –§–∞–π–ª: publish_999md.py, —Ñ—É–Ω–∫—Ü–∏—è fetch_next_raw_for_999.

================================================================================
–ö–û–ù–ï–¶ –ó–ê–ü–ò–°–ï–ô –ó–ê 2026-01-31
================================================================================
